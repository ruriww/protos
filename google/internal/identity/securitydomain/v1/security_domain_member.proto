edition = "2023";

package google.internal.identity.securitydomain.v1;

import "google/protobuf/timestamp.proto";
import "google/internal/identity/securitydomain/v1/shared_member_key.proto";
import "google/internal/identity/securitydomain/v1/rotation_proof.proto";
import "google/internal/identity/securitydomain/v1/membership_metadata.proto";

option objc_class_prefix = "SDS";

message SecurityDomainMember {
	message GooglePasswordManagerPinMetadata {
		protobuf.Timestamp expiration_time = 1;
		bytes encrypted_pin_hash = 2;

		enum PinFormat {
			PIN_FORMAT_UNSPECIFIED = 0;
			PIN_FORMAT_SIX_DIGITS = 1;
			PIN_FORMAT_ALPHANUMERIC = 2;
		}

		PinFormat pin_format = 3;
	}

	message PasskeyPrfMetadata {
		bytes prf_wrapped_key = 1;
		bytes credential_id = 2;
	}

	message RecoveryContactMetadata {
		bytes recovery_key = 1;
		bytes provider_public_key_hash = 3;
		string obfuscated_recovery_contact_gaia_id = 4;
	}

	string name = 1;
	bytes public_key = 2;

	message SecurityDomainMembership {
		string security_domain = 1;
		protobuf.Timestamp join_time = 2;
		repeated SharedMemberKey keys = 3;
		repeated RotationProof rotation_proofs = 4;
		MembershipMetadata metadata = 5;
	}

	repeated SecurityDomainMembership memberships = 3;

	enum MemberType {
		MEMBER_TYPE_UNSPECIFIED = 0;
		MEMBER_TYPE_PHYSICAL_DEVICE = 1;
		MEMBER_TYPE_LOCKSCREEN_KNOWLEDGE_FACTOR = 2;
		MEMBER_TYPE_GAIA_PASSWORD = 3;
		MEMBER_TYPE_ICLOUD_KEYCHAIN = 4;
		MEMBER_TYPE_GOOGLE_PASSWORD_MANAGER_PIN = 5;
		MEMBER_TYPE_DEVICE_PROMPT_CHALLENGE = 6;
		MEMBER_TYPE_PASSKEY_PRF = 7;
		MEMBER_TYPE_RECOVERY_CONTACT = 8;
	}

	MemberType member_type = 4;

	message GaiaPasswordMetadata {
		bool is_current_gaia_password = 1;
	}

	message PhysicalDeviceMetadata {
		enum DeviceType {
			UNKNOWN = 0;
			ANDROID = 1;
			IOS = 2;
			CHROME_OS = 3;
			WINDOWS = 4;
			MAC_OS = 5;
			LINUX = 6;
		}

		DeviceType device_type = 1;
		string dusi = 2;
	}

	message LskfMetadata {
		protobuf.Timestamp expiration_time = 1;
		bool user_consent_revoked = 2;
	}

	oneof member_metadata_variant {
		GaiaPasswordMetadata gaia_password_metadata = 5;
		PhysicalDeviceMetadata physical_device_metadata = 7;
		LskfMetadata lskf_metadata = 8;
	}

	message MemberMetadata {
		bool usable_for_retrieval = 1;

		oneof member_metadata_variant {
			GaiaPasswordMetadata gaia_password_metadata = 2;
			PhysicalDeviceMetadata physical_device_metadata = 3;
			LskfMetadata lskf_metadata = 4;
			GooglePasswordManagerPinMetadata google_password_manager_pin_metadata = 5;
			PasskeyPrfMetadata passkey_prf_metadata = 6;
			RecoveryContactMetadata recovery_contact_metadata = 7;
		}
	}

	MemberMetadata member_metadata = 6;
}
